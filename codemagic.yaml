workflows:
  # ===================================
  # iOS Workflow - –°–±–æ—Ä–∫–∞ –¥–ª—è iPhone
  # ===================================
  ios-release:
    name: iOS Release
    max_build_duration: 120
    instance_type: mac_mini_m1
    
    environment:
      ios_signing:
        distribution_type: app_store
        bundle_identifier: com.example.cleanupv1
      
      vars:
        # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
        FLUTTER_VERSION: 3.24.0
        XCODE_WORKSPACE: "Runner.xcworkspace"
        XCODE_SCHEME: "Runner"
      
      flutter: stable
      xcode: latest
      cocoapods: default
    
    scripts:
      - name: üì¶ Get Flutter packages
        script: |
          flutter packages pub get
      
      - name: üçé Install CocoaPods dependencies
        script: |
          cd ios && pod install
      
      - name: üèóÔ∏è Build iOS release
        script: |
          flutter build ipa --release \
            --export-options-plist=$HOME/export_options.plist
    
    artifacts:
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
    
    publishing:
      email:
        recipients:
          - kazban0v.beybit@gmail.com
        notify:
          success: true
          failure: true
      
      app_store_connect:
        # –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ TestFlight
        # –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å API –∫–ª—é—á –≤ Codemagic
        submit_to_testflight: true

  # ===================================
  # Android Workflow - –°–±–æ—Ä–∫–∞ –¥–ª—è Android
  # ===================================
  android-release:
    name: Android Release
    max_build_duration: 60
    instance_type: linux_x2
    
    environment:
      vars:
        FLUTTER_VERSION: 3.24.0
      
      flutter: stable
      
      groups:
        # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å signing credentials
        - android_credentials
    
    scripts:
      - name: üì¶ Get Flutter packages
        script: |
          flutter packages pub get
      
      - name: ü§ñ Build Android APK
        script: |
          flutter build apk --release
      
      - name: ü§ñ Build Android App Bundle
        script: |
          flutter build appbundle --release
    
    artifacts:
      - build/app/outputs/**/*.apk
      - build/app/outputs/**/*.aab
    
    publishing:
      email:
        recipients:
          - kazban0v.beybit@gmail.com
        notify:
          success: true
          failure: true
      
      google_play:
        # –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Google Play
        # –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å credentials –≤ Codemagic
        credentials: $GCLOUD_SERVICE_ACCOUNT_CREDENTIALS
        track: internal

  # ===================================
  # Development Workflow - –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
  # ===================================
  development:
    name: Development Build
    max_build_duration: 30
    instance_type: linux_x2
    
    triggering:
      events:
        - push
      branch_patterns:
        - pattern: 'develop'
          include: true
          source: true
    
    environment:
      flutter: stable
    
    scripts:
      - name: üì¶ Get packages
        script: flutter packages pub get
      
      - name: üß™ Run tests
        script: flutter test
        ignore_failure: true
      
      - name: üîç Analyze code
        script: flutter analyze
        ignore_failure: true
      
      - name: ü§ñ Build Android APK (Debug)
        script: flutter build apk --debug
    
    artifacts:
      - build/app/outputs/**/*.apk
    
    publishing:
      email:
        recipients:
          - kazban0v.beybit@gmail.com
        notify:
          success: false
          failure: true

